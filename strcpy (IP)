 .global copy

    .data

ptrString:        .quad 0

    .text

// Subroutine String_copy
// X0: Must point to a null terminated string
// LR: Must contain the return address
// All AAPCS required registers are preserved
//        x0... are modified and not preserved


copy:

    MOV    X7,X0                    // Set x7 = x0, contains pointer to string being copied
    BL     String_length

    MOV    X4,X0

    STR    X7,[SP,#-16]!        // String to copy
    STR    X4,[SP,#-16]!        // Length of string
    STR    X30,[SP,#-16]!

    MOV    X0,X2                    // Set x0 = x2, length of string
    BL      malloc                // Allocate enough bytes for length of string

    LDR    X1,=ptrString
    STR    X0,[X1]

    LDR    X30,[SP],#16
    LDR    X4,[SP],#16
    LDR    X7,[SP],#16

loop2_copy:

   LDRB    W7,[X1]
   STRB       


    RET    LR

    .end
 
 .end
